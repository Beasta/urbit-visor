import React from 'react';
import * as CSS from 'csstype';
import { useEffect, useState, useRef } from 'react';
import Urbit from '@urbit/http-api';
import PokeInput from './input/PokeInput';
import ScryInput from './input/ScryInput';
import SubscribeInput from './input/SubscribeInput';
import SpiderInput from './input/SpiderInput';
import TerminalInput from './input/TerminalInput';
import DMInput from './input/DMInput';
import GroupsInput from './input/GroupsInput';
import NotificationInput from './input/NotificationInput';
import BaseInput from './BaseInput';

import { Command, ContextMenuItem, MenuItem } from './types';
import Input from './Input';

interface InputProps {
  selectedToInput: MenuItem;
  selected: MenuItem;
  metadata?: Object;
  baseFocus: Boolean;
  nextArg: Boolean;
  previousArg: Boolean;
  sendCommand: Boolean;
  airlockResponse: (response: any) => void;
  clearSelected: (clear: Boolean) => void;
  contextItems: (items: ContextMenuItem[]) => void;
}

const Inputbox = (props: InputProps) => {
  let command;

  const selectedCommand = (selected: any): selected is Command => (selected?.title ? true : false);
  const selectedContext = (selected: any): selected is ContextMenuItem =>
    selected?.commandTitle ? true : false;

  switch (
    selectedContext(props.selected) ? props.selected?.commandTitle : props.selectedToInput?.title
  ) {
    case 'poke':
      command = <PokeInput {...props} />;
      break;
    case 'scry':
      command = <ScryInput {...props} />;
      break;
    case 'subscribe':
      command = <SubscribeInput {...props} />;
      break;
    case 'thread':
      command = <SpiderInput {...props} />;
      break;
    case 'terminal':
      command = <TerminalInput {...props} />;
      break;
    case 'DM':
      command = <DMInput {...props} />;
      break;
    case 'groups':
      command = <GroupsInput {...props} />;
      break;
    case 'notifications':
      command = <NotificationInput {...props} />;
      break;
    default:
      command = <BaseInput {...props} />;
  }

  return (
    <div className="modal-input-box">
      <div className="logo-container">
        <div className="logo">
          <svg
            width="121"
            height="24"
            viewBox="0 0 121 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M9.15858 0C8.18594 0 5.14647 1.90398 4.78174 2.25016L5.35924 3.75026L8.93393 5.64147C9.41011 4.96834 10.1616 3.05791 10.3744 1.96168C10.5451 1.08218 10.1312 0 9.15858 0Z"
              fill="url(#paint0_linear_129_3631)"
            />
            <path
              d="M34.6146 11.712C34.6146 9.98359 33.4441 9.40745 32.5848 9.58939C29.0402 10.8326 22.5263 10.0746 19.6785 9.25583C16.8306 8.4371 10.4987 5.61702 9.34745 5.19249C6.07545 4.0402 4.9352 2.67565 4.7838 2.25112C2.14794 9.55907 -3.55877 18.8023 3.13678 21.931C13.1952 26.6311 26.7376 22.0523 29.5249 20.051C32.3121 18.0496 34.6146 13.4405 34.6146 11.712Z"
              fill="#00B171"
            />
            <mask
              id="mask0_129_3631"
              style={{ maskType: 'alpha' }}
              maskUnits="userSpaceOnUse"
              x="0"
              y="2"
              width="35"
              height="22"
            >
              <path
                d="M34.5964 11.7257C34.5964 9.99658 33.4267 9.4202 32.568 9.60221C29.0259 10.846 22.5167 10.0876 19.6709 9.26852C16.825 8.44945 10.4976 5.6282 9.34717 5.2035C6.07749 4.05073 4.93805 2.68561 4.78675 2.26091C2.15277 9.57188 -3.54989 18.819 3.14091 21.949C13.1922 26.651 26.725 22.0703 29.5103 20.0681C32.2955 18.066 34.5964 13.4549 34.5964 11.7257Z"
                fill="#00B171"
              />
            </mask>
            <g mask="url(#mask0_129_3631)">
              <path
                d="M3.51514 26.7532L14.2626 0.835106L24.3216 4.73482L16.1487 27.7731L3.51514 26.7532Z"
                fill="url(#paint1_linear_129_3631)"
              />
              <ellipse
                rx="9.58416"
                ry="16.787"
                transform="matrix(0.915472 0.402381 -0.401021 0.916069 9.27279 12.416)"
                fill="url(#paint2_linear_129_3631)"
              />
              <path
                d="M13.4224 17.8567C23.5018 19.0694 34.3209 10.6981 35.7334 9.88102L33.4967 28.642L15.4812 33.1469L-6.94146 12.1691C-3.51331 13.6607 5.35887 16.8865 13.4224 17.8567Z"
                fill="url(#paint3_linear_129_3631)"
              />
            </g>
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M9.18168 10.384C7.53818 9.63142 5.99011 10.2677 4.976 10.9737C3.95277 11.686 3.17773 12.6553 2.84692 13.2237L4.11256 13.9633C4.34691 13.5607 4.98146 12.7576 5.81198 12.1794C6.64442 11.5999 7.62136 11.2798 8.58051 11.7229L8.59309 11.7287L8.60588 11.7341C8.94001 11.8733 9.20553 12.1305 9.43895 12.465C9.61563 12.7183 9.74165 12.9624 9.87103 13.213C9.92329 13.3142 9.97609 13.4164 10.033 13.5208C10.0661 13.5815 10.105 13.6573 10.1491 13.743C10.2779 13.9937 10.4505 14.3295 10.6491 14.6233C10.9345 15.0453 11.3373 15.4917 11.9408 15.7713C12.9045 16.2177 13.9373 16.0556 14.7221 15.6664C15.5163 15.2725 16.1701 14.6198 16.6247 13.9822L15.4325 13.1287C15.0749 13.6303 14.5925 14.0925 14.0721 14.3506C13.5707 14.5993 13.0142 14.6511 12.5556 14.4386C12.2773 14.3097 12.0595 14.0918 11.862 13.7997C11.7158 13.5834 11.611 13.3791 11.4962 13.1553C11.4412 13.0481 11.384 12.9364 11.3188 12.8168C11.2883 12.7609 11.2522 12.691 11.211 12.6112C11.0732 12.344 10.8778 11.9651 10.6398 11.6239C10.318 11.1627 9.85826 10.6699 9.18168 10.384Z"
              fill="url(#paint4_linear_129_3631)"
            />
            <path
              d="M46.8706 17.6837C47.3001 17.6837 47.6828 17.6142 48.0186 17.4751C48.36 17.336 48.6463 17.1407 48.8776 16.8892C49.1088 16.6378 49.285 16.3328 49.4061 15.9744C49.5328 15.6159 49.5961 15.2147 49.5961 14.7706V7.82098H51.8177V14.7706C51.8177 15.4608 51.7021 16.1001 51.4709 16.6886C51.2451 17.2718 50.9175 17.7773 50.488 18.2054C50.0641 18.628 49.5465 18.9597 48.9354 19.2005C48.3242 19.4359 47.636 19.5536 46.8706 19.5536C46.0998 19.5536 45.4088 19.4359 44.7976 19.2005C44.1865 18.9597 43.6662 18.628 43.2367 18.2054C42.8128 17.7773 42.4851 17.2718 42.2539 16.6886C42.0282 16.1001 41.9153 15.4608 41.9153 14.7706V7.82098H44.1369V14.7626C44.1369 15.2067 44.1975 15.6079 44.3186 15.9664C44.4453 16.3248 44.6242 16.6324 44.8555 16.8892C45.0922 17.1407 45.3785 17.336 45.7144 17.4751C46.0558 17.6142 46.4412 17.6837 46.8706 17.6837Z"
              fill="#F1F5F3"
            />
            <path
              d="M55.6513 12.6199C55.9156 12.1277 56.2294 11.7425 56.5928 11.4643C56.9562 11.1808 57.3857 11.039 57.8812 11.039C58.2721 11.039 58.586 11.1219 58.8227 11.2878L58.6906 12.7724C58.663 12.8687 58.6217 12.9383 58.5667 12.9811C58.5171 13.0185 58.4483 13.0372 58.3602 13.0372C58.2776 13.0372 58.1537 13.0239 57.9886 12.9971C57.8289 12.9704 57.672 12.957 57.5178 12.957C57.2921 12.957 57.0911 12.9891 56.9149 13.0533C56.7387 13.1175 56.579 13.2111 56.4359 13.3342C56.2982 13.4519 56.1744 13.5963 56.0642 13.7675C55.9596 13.9387 55.8605 14.134 55.7669 14.3533V19.4252H53.727V11.1915H54.9245C55.1337 11.1915 55.2796 11.2289 55.3622 11.3038C55.4448 11.3734 55.4999 11.5018 55.5274 11.689L55.6513 12.6199Z"
              fill="#F1F5F3"
            />
            <path
              d="M61.9288 17.2905C62.1601 17.5634 62.4106 17.756 62.6804 17.8683C62.9557 17.9807 63.2448 18.0368 63.5476 18.0368C63.8614 18.0368 64.1422 17.9833 64.39 17.8763C64.6433 17.764 64.858 17.5928 65.0342 17.3627C65.2104 17.1273 65.3453 16.8304 65.4389 16.4719C65.5325 16.1081 65.5793 15.6748 65.5793 15.1719C65.5793 14.2677 65.4251 13.615 65.1168 13.2138C64.8084 12.8072 64.3652 12.6039 63.7871 12.6039C63.3962 12.6039 63.0548 12.6922 62.763 12.8687C62.4712 13.0399 62.1931 13.2833 61.9288 13.599V17.2905ZM61.9288 12.2026C62.2702 11.8549 62.6474 11.5794 63.0603 11.3761C63.4788 11.1674 63.955 11.0631 64.4891 11.0631C64.9791 11.0631 65.4196 11.1567 65.8105 11.344C66.207 11.5312 66.5428 11.8014 66.8181 12.1545C67.0989 12.5022 67.3137 12.9249 67.4623 13.4224C67.611 13.92 67.6853 14.4791 67.6853 15.0997C67.6853 15.7684 67.6 16.3756 67.4293 16.9213C67.2586 17.4671 67.0136 17.9352 66.6942 18.3257C66.3804 18.7109 66.0005 19.0105 65.5545 19.2245C65.1085 19.4385 64.613 19.5455 64.0679 19.5455C63.8036 19.5455 63.5641 19.5188 63.3494 19.4653C63.1346 19.4171 62.9364 19.3476 62.7547 19.2566C62.573 19.1657 62.4051 19.056 62.2509 18.9276C62.1023 18.7939 61.9591 18.6467 61.8215 18.4862L61.7306 19.04C61.6976 19.1791 61.6398 19.278 61.5572 19.3369C61.4801 19.3957 61.3727 19.4252 61.2351 19.4252H59.8889V7.49998H61.9288V12.2026Z"
              fill="#F1F5F3"
            />
            <path
              d="M71.3751 11.1915V19.4252H69.3269V11.1915H71.3751ZM71.6559 8.79201C71.6559 8.96321 71.6201 9.12371 71.5485 9.27351C71.477 9.42331 71.3806 9.55439 71.2595 9.66674C71.1439 9.77909 71.0062 9.87004 70.8465 9.93959C70.6869 10.0038 70.5162 10.0359 70.3345 10.0359C70.1583 10.0359 69.9904 10.0038 69.8307 9.93959C69.6765 9.87004 69.5416 9.77909 69.426 9.66674C69.3104 9.55439 69.2168 9.42331 69.1452 9.27351C69.0791 9.12371 69.0461 8.96321 69.0461 8.79201C69.0461 8.61546 69.0791 8.44961 69.1452 8.29446C69.2168 8.13931 69.3104 8.00556 69.426 7.89321C69.5416 7.78086 69.6765 7.69259 69.8307 7.62839C69.9904 7.55883 70.1583 7.52406 70.3345 7.52406C70.5162 7.52406 70.6869 7.55883 70.8465 7.62839C71.0062 7.69259 71.1439 7.78086 71.2595 7.89321C71.3806 8.00556 71.477 8.13931 71.5485 8.29446C71.6201 8.44961 71.6559 8.61546 71.6559 8.79201Z"
              fill="#F1F5F3"
            />
            <path
              d="M76.2794 19.5536C75.5416 19.5536 74.9744 19.3529 74.578 18.9517C74.1871 18.5451 73.9916 17.986 73.9916 17.2745V12.6761H73.1244C73.0143 12.6761 72.9207 12.6413 72.8436 12.5718C72.7666 12.5022 72.728 12.3979 72.728 12.2588V11.4724L74.0907 11.2557L74.5202 9.00869C74.5477 8.90169 74.6 8.81876 74.6771 8.75991C74.7542 8.70106 74.8533 8.67164 74.9744 8.67164H76.0316V11.2637H78.2945V12.6761H76.0316V17.138C76.0316 17.3948 76.0949 17.5955 76.2215 17.7399C76.3537 17.8844 76.5326 17.9566 76.7584 17.9566C76.885 17.9566 76.9896 17.9432 77.0722 17.9165C77.1603 17.8844 77.2346 17.8523 77.2952 17.8202C77.3613 17.7881 77.4191 17.7586 77.4686 17.7319C77.5182 17.6998 77.5677 17.6837 77.6173 17.6837C77.6779 17.6837 77.7274 17.6998 77.766 17.7319C77.8045 17.7586 77.8458 17.8014 77.8898 17.8603L78.501 18.8233C78.2037 19.064 77.8623 19.2459 77.4769 19.369C77.0915 19.492 76.6923 19.5536 76.2794 19.5536Z"
              fill="#F1F5F3"
            />
            <path
              d="M93.5591 7.82098L88.7359 19.4252H86.729L81.9057 7.82098H83.6897C83.8824 7.82098 84.0393 7.86646 84.1604 7.95741C84.2816 8.04836 84.3724 8.16606 84.433 8.31051L87.2493 15.3886C87.3429 15.6186 87.431 15.8727 87.5135 16.1509C87.6016 16.4238 87.6842 16.71 87.7613 17.0096C87.8274 16.71 87.899 16.4238 87.976 16.1509C88.0531 15.8727 88.1385 15.6186 88.2321 15.3886L91.0318 8.31051C91.0759 8.18746 91.1612 8.07511 91.2879 7.97346C91.42 7.87181 91.5797 7.82098 91.7669 7.82098H93.5591Z"
              fill="#F1F5F3"
            />
            <path
              d="M96.5874 11.1915V19.4252H94.5392V11.1915H96.5874ZM96.8682 8.79201C96.8682 8.96321 96.8324 9.12371 96.7608 9.27351C96.6892 9.42331 96.5929 9.55439 96.4718 9.66674C96.3561 9.77909 96.2185 9.87004 96.0588 9.93959C95.8991 10.0038 95.7285 10.0359 95.5468 10.0359C95.3706 10.0359 95.2026 10.0038 95.043 9.93959C94.8888 9.87004 94.7539 9.77909 94.6383 9.66674C94.5227 9.55439 94.4291 9.42331 94.3575 9.27351C94.2914 9.12371 94.2584 8.96321 94.2584 8.79201C94.2584 8.61546 94.2914 8.44961 94.3575 8.29446C94.4291 8.13931 94.5227 8.00556 94.6383 7.89321C94.7539 7.78086 94.8888 7.69259 95.043 7.62839C95.2026 7.55883 95.3706 7.52406 95.5468 7.52406C95.7285 7.52406 95.8991 7.55883 96.0588 7.62839C96.2185 7.69259 96.3561 7.78086 96.4718 7.89321C96.5929 8.00556 96.6892 8.13931 96.7608 8.29446C96.8324 8.44961 96.8682 8.61546 96.8682 8.79201Z"
              fill="#F1F5F3"
            />
            <path
              d="M103.837 12.7965C103.782 12.8821 103.724 12.9436 103.664 12.9811C103.603 13.0132 103.526 13.0292 103.432 13.0292C103.333 13.0292 103.226 13.0025 103.11 12.949C103 12.8955 102.871 12.8366 102.722 12.7724C102.574 12.7029 102.403 12.6413 102.21 12.5878C102.023 12.5343 101.8 12.5076 101.541 12.5076C101.139 12.5076 100.823 12.5905 100.591 12.7564C100.366 12.9222 100.253 13.1389 100.253 13.4064C100.253 13.5829 100.311 13.7327 100.426 13.8558C100.547 13.9735 100.704 14.0778 100.897 14.1688C101.095 14.2597 101.318 14.3426 101.566 14.4175C101.814 14.4871 102.064 14.5647 102.318 14.6503C102.576 14.7359 102.83 14.8348 103.077 14.9472C103.325 15.0542 103.545 15.1933 103.738 15.3645C103.936 15.5303 104.093 15.731 104.209 15.9664C104.33 16.2018 104.391 16.4853 104.391 16.817C104.391 17.2129 104.316 17.5794 104.168 17.9165C104.024 18.2482 103.81 18.5371 103.523 18.7832C103.237 19.0239 102.882 19.2138 102.458 19.3529C102.039 19.4867 101.555 19.5536 101.004 19.5536C100.713 19.5536 100.426 19.5268 100.145 19.4733C99.8701 19.4252 99.6031 19.3556 99.3443 19.2647C99.091 19.1737 98.8543 19.0667 98.6341 18.9437C98.4193 18.8206 98.2294 18.6869 98.0642 18.5424L98.5349 17.7881C98.5955 17.6971 98.6671 17.6276 98.7497 17.5794C98.8323 17.5313 98.9369 17.5072 99.0635 17.5072C99.1902 17.5072 99.3085 17.542 99.4186 17.6115C99.5343 17.6811 99.6664 17.756 99.8151 17.8362C99.9637 17.9165 100.137 17.9914 100.335 18.0609C100.539 18.1305 100.795 18.1652 101.103 18.1652C101.346 18.1652 101.552 18.1385 101.723 18.085C101.899 18.0261 102.042 17.9512 102.152 17.8603C102.268 17.7693 102.351 17.665 102.4 17.5473C102.455 17.4243 102.483 17.2985 102.483 17.1701C102.483 16.9775 102.422 16.8197 102.301 16.6966C102.185 16.5736 102.028 16.4666 101.83 16.3756C101.638 16.2847 101.415 16.2044 101.161 16.1349C100.914 16.06 100.657 15.9797 100.393 15.8941C100.134 15.8085 99.8784 15.7096 99.6251 15.5972C99.3774 15.4795 99.1544 15.3324 98.9561 15.1558C98.7634 14.9793 98.6065 14.7626 98.4854 14.5058C98.3698 14.249 98.312 13.9387 98.312 13.5749C98.312 13.2379 98.3808 12.9169 98.5184 12.6119C98.6561 12.307 98.857 12.0421 99.1213 11.8174C99.3911 11.5874 99.7242 11.4055 100.121 11.2717C100.523 11.1326 100.985 11.0631 101.508 11.0631C102.092 11.0631 102.623 11.1567 103.102 11.344C103.581 11.5312 103.98 11.7773 104.3 12.0823L103.837 12.7965Z"
              fill="#F1F5F3"
            />
            <path
              d="M109.675 11.0631C110.303 11.0631 110.873 11.1621 111.385 11.36C111.903 11.558 112.343 11.8388 112.706 12.2026C113.075 12.5664 113.359 13.0105 113.557 13.5348C113.755 14.0591 113.854 14.6449 113.854 15.2923C113.854 15.945 113.755 16.5335 113.557 17.0578C113.359 17.5821 113.075 18.0288 112.706 18.398C112.343 18.7671 111.903 19.0507 111.385 19.2486C110.873 19.4466 110.303 19.5455 109.675 19.5455C109.042 19.5455 108.467 19.4466 107.949 19.2486C107.432 19.0507 106.989 18.7671 106.62 18.398C106.256 18.0288 105.973 17.5821 105.769 17.0578C105.571 16.5335 105.472 15.945 105.472 15.2923C105.472 14.6449 105.571 14.0591 105.769 13.5348C105.973 13.0105 106.256 12.5664 106.62 12.2026C106.989 11.8388 107.432 11.558 107.949 11.36C108.467 11.1621 109.042 11.0631 109.675 11.0631ZM109.675 18.0208C110.38 18.0208 110.901 17.7907 111.236 17.3306C111.578 16.8705 111.748 16.1964 111.748 15.3083C111.748 14.4202 111.578 13.7434 111.236 13.278C110.901 12.8125 110.38 12.5798 109.675 12.5798C108.96 12.5798 108.428 12.8152 108.081 13.286C107.74 13.7515 107.569 14.4256 107.569 15.3083C107.569 16.1911 107.74 16.8652 108.081 17.3306C108.428 17.7907 108.96 18.0208 109.675 18.0208Z"
              fill="#F1F5F3"
            />
            <path
              d="M117.335 12.6199C117.599 12.1277 117.913 11.7425 118.277 11.4643C118.64 11.1808 119.069 11.039 119.565 11.039C119.956 11.039 120.27 11.1219 120.507 11.2878L120.374 12.7724C120.347 12.8687 120.306 12.9383 120.25 12.9811C120.201 13.0185 120.132 13.0372 120.044 13.0372C119.961 13.0372 119.838 13.0239 119.672 12.9971C119.513 12.9704 119.356 12.957 119.202 12.957C118.976 12.957 118.775 12.9891 118.599 13.0533C118.423 13.1175 118.263 13.2111 118.12 13.3342C117.982 13.4519 117.858 13.5963 117.748 13.7675C117.643 13.9387 117.544 14.134 117.451 14.3533V19.4252H115.411V11.1915H116.608C116.818 11.1915 116.963 11.2289 117.046 11.3038C117.129 11.3734 117.184 11.5018 117.211 11.689L117.335 12.6199Z"
              fill="#F1F5F3"
            />
            <defs>
              <linearGradient
                id="paint0_linear_129_3631"
                x1="7.59678"
                y1="0"
                x2="7.59678"
                y2="5.64147"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#03A268" />
                <stop offset="1" stop-color="#005738" stop-opacity="0.88" />
              </linearGradient>
              <linearGradient
                id="paint1_linear_129_3631"
                x1="5.40119"
                y1="6.98465"
                x2="19.2383"
                y2="25.6766"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#11DE94" />
                <stop offset="1" stop-color="#11DE94" stop-opacity="0" />
              </linearGradient>
              <linearGradient
                id="paint2_linear_129_3631"
                x1="11.7624"
                y1="12.2674"
                x2="-1.93721"
                y2="20.1006"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#72FFCC" stop-opacity="0.59" />
                <stop offset="1" stop-color="#47EAAF" stop-opacity="0" />
              </linearGradient>
              <linearGradient
                id="paint3_linear_129_3631"
                x1="24.7585"
                y1="31.302"
                x2="15.6582"
                y2="9.54695"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#004F32" />
                <stop offset="1" stop-color="#00B171" stop-opacity="0" />
              </linearGradient>
              <linearGradient
                id="paint4_linear_129_3631"
                x1="9.7358"
                y1="10.045"
                x2="7.71645"
                y2="15.8837"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="white" />
                <stop offset="1" stop-color="white" stop-opacity="0" />
              </linearGradient>
            </defs>
          </svg>
        </div>
      </div>
      {command}
    </div>
  );
};

export default Inputbox;
